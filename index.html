<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Key Access</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding-top: 50px; }
  </style>
</head>
<body>
  <div id="content" style="display:none;">
    <h1>Welcome!</h1>
    <p>Your key: </p>
    <code id="keyBox">Generating...</code>
  </div>

  <div id="blocked" style="display:none;">
    <h1>Access Denied</h1>
    <p>Please use the official link.</p>
  </div>

  <script>
    const referrer = document.referrer;
    const allowedRef = "tpi.li";
    const encryptionKey = "abc"; 

    function xorEncrypt(text, key) {
  let output = '';
  for (let i = 0; i < text.length; i++) {
    output += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
  }
  return btoa(output); // base64 encode
}

    if (referrer.includes(allowedRef)) {
      fetch("https://icanhazip.com/")
        .then(response => response.text())
        .then(ip => {
          const trimmedIP = ip.trim();
         const encrypted = xorEncrypt(trimmedIP, encryptionKey);
          document.getElementById("keyBox").textContent = encrypted;
          document.getElementById("content").style.display = "block";
        })
        .catch(() => {
          document.getElementById("keyBox").textContent = "Failed to get IP.";
          document.getElementById("content").style.display = "block";
        });
    } else {
      document.getElementById("blocked").style.display = "block";
    }
  </script>
</body>
</html>
